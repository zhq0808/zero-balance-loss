# 🧪 前端代码控制台测试清单

## 测试环境准备

- [x] Docker Desktop 运行中
- [x] MySQL 容器启动 (docker-compose up -d mysql)
- [x] Go 编译成功 (go build -o zero-balance-loss.exe)
- [x] 应用已启动 (http://localhost:8080)

## UI 显示测试

### 1. 页面加载
- [ ] 打开 http://localhost:8080
- [ ] 看到"💻 交互式代码控制台"标题
- [ ] 两个代码块并排显示
- [ ] 左侧代码块标题: "无锁版本 (存在并发问题)"
- [ ] 右侧代码块标题: "加锁版本 (使用互斥锁)"
- [ ] 代码有语法高亮（深色背景）

### 2. 初始状态
- [ ] Toggle开关在左侧（关闭）
- [ ] 状态显示"🔓 无锁"（红色背景）
- [ ] 左侧代码块有蓝色边框高亮
- [ ] 右侧代码块无特殊边框

### 3. Toggle开关样式
- [ ] 开关是灰色背景（关闭状态）
- [ ] 圆形滑块在左侧
- [ ] 鼠标悬停有cursor: pointer
- [ ] 状态标签在开关右侧

## 功能测试

### 4. 切换到加锁模式
**操作**: 点击Toggle开关

**预期结果**:
- [ ] 开关滑动到右侧
- [ ] 开关变为绿色背景
- [ ] 状态变为"🔒 已加锁"（绿色背景）
- [ ] 左侧代码块边框消失
- [ ] 右侧代码块出现蓝色边框
- [ ] 浏览器控制台输出: "模式切换成功: {mode: 'locked', use_lock: true}"
- [ ] 浏览器控制台输出: "UI已更新，当前模式: 加锁"

### 5. 切换回无锁模式
**操作**: 再次点击Toggle开关

**预期结果**:
- [ ] 开关滑动到左侧
- [ ] 开关变为灰色背景
- [ ] 状态变为"🔓 无锁"（红色背景）
- [ ] 右侧代码块边框消失
- [ ] 左侧代码块出现蓝色边框
- [ ] 控制台输出切换成功消息

### 6. 页面刷新持久化
**操作**: F5 刷新页面

**预期结果**:
- [ ] 页面重新加载
- [ ] Toggle开关状态与刷新前一致
- [ ] 代码块高亮状态正确
- [ ] 状态标签显示正确

## API 通信测试

### 7. 网络请求检查
**操作**: 打开浏览器开发者工具 → Network标签 → 切换模式

**预期请求**:
- [ ] 请求方法: POST
- [ ] 请求URL: http://localhost:8080/api/mode/switch
- [ ] 请求头: Content-Type: application/json
- [ ] 请求体 (关→开): `{"use_lock":true}`
- [ ] 请求体 (开→关): `{"use_lock":false}`
- [ ] 响应状态码: 200
- [ ] 响应体包含: `{"code":200,"message":"mode switched successfully"}`

### 8. WebSocket 消息检查
**操作**: 开发者工具 → Network → WS → 选择ws连接 → Messages

**预期消息** (切换到加锁模式):
```json
{
  "type": "mode_changed",
  "data": {
    "mode": "locked",
    "use_lock": true
  },
  "timestamp": 1738483200000
}
```

### 9. 获取状态API
**操作**: 访问 http://localhost:8080/api/mode/status

**预期响应**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "mode": "unlocked",  // 或 "locked"
    "use_lock": false    // 或 true
  }
}
```

## 并发行为测试

### 10. 无锁模式 - 余额丢失验证
**操作**:
1. 确保Toggle在左侧（无锁）
2. 点击"重置余额"
3. 设置: 并发数50, 每次扣款10元, 请求次数10
4. 点击"发起并发攻击"

**预期结果**:
- [ ] 攻击进行中，状态标签保持"🔓 无锁"
- [ ] 攻击结束后，丢失金额 > 0.00元
- [ ] 余额水位图: 红色线（实际）低于蓝色线（理论）
- [ ] 追踪列表显示多个请求读取到相同余额

### 11. 加锁模式 - 余额正确性验证
**操作**:
1. 点击Toggle切换到右侧（加锁）
2. 点击"重置余额"
3. 使用相同参数发起攻击

**预期结果**:
- [ ] 攻击进行中，状态标签保持"🔒 已加锁"
- [ ] 攻击结束后，丢失金额 = 0.00元
- [ ] 余额水位图: 红色线与蓝色线完全重合
- [ ] 追踪列表显示请求串行执行

### 12. 运行中切换模式
**操作**:
1. 无锁模式下发起攻击
2. 攻击进行中切换到加锁模式
3. 观察余额变化

**预期结果**:
- [ ] 切换成功，状态标签立即更新
- [ ] 正在执行的请求不受影响
- [ ] 新请求使用新模式
- [ ] 图表显示过渡期的"拐点"

## 多客户端同步测试

### 13. 双窗口同步
**操作**:
1. 打开两个浏览器窗口
2. 在窗口1切换模式

**预期结果**:
- [ ] 窗口2的Toggle自动同步
- [ ] 窗口2的状态标签自动更新
- [ ] 窗口2的代码块高亮自动切换
- [ ] 两个窗口保持完全一致

## 错误处理测试

### 14. 后端服务停止
**操作**:
1. 停止Go服务 (Ctrl+C)
2. 尝试切换模式

**预期结果**:
- [ ] 弹出提示: "切换模式失败，请重试"
- [ ] Toggle开关恢复到之前状态
- [ ] 页面不崩溃

### 15. 网络延迟模拟
**操作**: 开发者工具 → Network → Throttling → Slow 3G

**预期结果**:
- [ ] 切换模式时有明显延迟
- [ ] 最终状态正确更新
- [ ] 没有重复请求

## 代码质量检查

### 16. 控制台错误检查
**操作**: F12 → Console

**预期结果**:
- [ ] 无 JavaScript 错误
- [ ] 无 404 资源请求
- [ ] highlight.js 成功加载
- [ ] WebSocket 连接成功

### 17. 响应式布局
**操作**: 调整浏览器窗口大小

**预期结果**:
- [ ] 代码块自适应宽度
- [ ] 窄屏下代码可横向滚动
- [ ] Toggle开关位置保持合理

## 性能测试

### 18. 页面加载时间
- [ ] 首次加载 < 2秒
- [ ] Highlight.js CDN加载成功
- [ ] 代码高亮渲染 < 500ms

### 19. 切换响应时间
- [ ] 点击Toggle到UI更新 < 100ms
- [ ] API响应时间 < 200ms

## 兼容性测试

### 20. 浏览器兼容性
- [ ] Chrome (最新版)
- [ ] Edge (最新版)
- [ ] Firefox (最新版)

## 文档验证

### 21. INTERACTIVE_CODE_CONSOLE.md
- [ ] 文档存在并可读
- [ ] 使用流程描述准确
- [ ] API文档与实际一致
- [ ] 代码行号引用正确

### 22. start.bat
- [ ] 脚本可执行
- [ ] Docker检查正常工作
- [ ] 编译步骤无误
- [ ] 启动提示清晰

## 总结

测试通过项: _____ / 22

关键问题记录:
- 
- 
- 

测试日期: ___________
测试人员: ___________
